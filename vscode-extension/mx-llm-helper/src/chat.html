<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        padding: 0;
        margin: 0;
        background: var(--vscode-editor-background);
        color: var(--vscode-editor-foreground);
        font-family: var(--vscode-font-family);
      }
      .chat-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
      }
      .messages {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
      }
      .message {
        margin-bottom: 10px;
        padding: 8px;
        border-radius: 6px;
        max-width: 80%;
      }
      .user-message {
        background: var(--vscode-input-background);
        margin-left: auto;
      }
      .assistant-message {
        background: var(--vscode-editor-inactiveSelectionBackground);
        margin-right: auto;
      }
      .input-container {
        padding: 10px;
        border-top: 1px solid var(--vscode-panel-border);
        display: flex;
        gap: 10px;
      }
      #messageInput {
        flex: 1;
        padding: 8px;
        border: 1px solid var(--vscode-input-border);
        background: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
        border-radius: 4px;
      }
      #sendButton {
        padding: 8px 16px;
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      #sendButton:hover {
        background: var(--vscode-button-hoverBackground);
      }
      .code-block {
        background: var(--vscode-editor-background);
        padding: 10px;
        border-radius: 4px;
        margin: 5px 0;
        font-family: var(--vscode-editor-font-family);
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="messages" id="messages"></div>
      <div class="input-container">
        <input
          type="text"
          id="messageInput"
          placeholder="Type your message..."
        />
        <button id="sendButton">Send</button>
      </div>
    </div>
    <script>
      const vscode = acquireVsCodeApi();
      const messagesContainer = document.getElementById("messages");
      const messageInput = document.getElementById("messageInput");
      const sendButton = document.getElementById("sendButton");

      // Mock data for testing
      const mockResponses = {
        hello: "Hello! How can I help you with your code today?",
        help: "I can help you understand code, suggest improvements, or answer questions about programming.",
        default: "I understand your question. Let me help you with that.",
      };

      function addMessage(text, isUser = false) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${
          isUser ? "user-message" : "assistant-message"
        }`;

        // Check if the message contains code (simple check for now)
        if (text.includes("```")) {
          const parts = text.split("```");
          parts.forEach((part, index) => {
            if (index % 2 === 0) {
              messageDiv.appendChild(document.createTextNode(part));
            } else {
              const codeBlock = document.createElement("pre");
              codeBlock.className = "code-block";
              codeBlock.textContent = part;
              messageDiv.appendChild(codeBlock);
            }
          });
        } else {
          messageDiv.textContent = text;
        }

        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function sendMessage() {
        const message = messageInput.value.trim();
        if (message) {
          addMessage(message, true);
          messageInput.value = "";

          // Mock response
          const response =
            mockResponses[message.toLowerCase()] || mockResponses.default;
          setTimeout(() => {
            addMessage(response);
          }, 500);
        }
      }

      sendButton.addEventListener("click", sendMessage);
      messageInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          sendMessage();
        }
      });

      // Handle messages from the extension
      window.addEventListener("message", (event) => {
        const message = event.data;
        switch (message.type) {
          case "addMessage":
            addMessage(message.text, message.isUser);
            break;
        }
      });
    </script>
  </body>
</html>
